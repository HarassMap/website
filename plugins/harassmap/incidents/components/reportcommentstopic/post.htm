<div class="content mb-5">

    <strong>{{ post.member.user.username }}</strong>

    <span class="timestamp">
        <a href="#post-{{ post.id }}">{% partial __SELF__ ~ "::timestamp" date=post.created_at %}</a>
    </span>

    {% if mode == 'edit' %}

        <div class="alerts pt-2"></div>

        {{ form_open() }}
        <!-- Passable fields -->
        <input type="hidden" name="mode" value="save"/>
        <input type="hidden" name="post" value="{{ post.id }}"/>

        {% if topic.first_post.id == post.id %}
            <input type="hidden" name="subject" class="form-control" value="{{ topic.subject }}" />
        {% endif %}

        <div class="text mb-1">
            <textarea rows="5" name="content" class="form-control">{{ post.content }}</textarea>
        </div>

        <div class="actions">
            <a href="javascript:;"
               data-request="{{ __SELF__ }}::onUpdate"
               data-request-data="post: {{ post.id }}"
               data-request-update="'{{ __SELF__ }}::post': '#post-{{ post.id }}'"
               class="save btn btn--default">
                {{ 'Save' | _ }}
            </a>

            <a href="javascript:;"
               data-request="{{ __SELF__ }}::onUpdate"
               data-request-data="post: {{ post.id }}, mode: 'delete'"
               data-request-update="'{{ __SELF__ }}::post': '#post-{{ post.id }}'"
               data-request-confirm="Are you sure?"
               class="delete btn btn--default">
                {{ 'Delete' | _ }}
            </a>

            <a href="javascript:;"
               data-request="{{ __SELF__ }}::onUpdate"
               data-request-data="post: {{ post.id }}, mode: 'view'"
               data-request-update="'{{ __SELF__ }}::post': '#post-{{ post.id }}'"
               class="cancel btn btn--default">
                {{ 'Cancel' | _ }}
            </a>
        </div>
        {{ form_close() }}

    {% elseif mode == 'delete' %}
        <div class="text">
            <p><em>{{ 'Comment has been deleted' | _ }}</em></p>
        </div>
    {% else %}
        <div class="text">
            {{ post.content_html|raw }}

            {% if post.created_at != post.updated_at %}
                <p class="mt-2 mb-2">
                    <small class="text text-muted">
                        Last updated {% partial __SELF__ ~ "::timestamp" date=post.updated_at %}
                    </small>
                </p>
            {% endif %}
        </div>
        <div class="actions">
            {% if topic.canPost and post.canEdit and mode != 'edit' and mode != 'delete' %}
                <a href="javascript:;"
                   class="edit btn btn--default"
                   data-request="onUpdate"
                   data-request-data="post: {{ post.id }}"
                   data-request-update="'{{ __SELF__ ~ '::post' }}': '#post-{{ post.id }}'">
                    {{ 'Edit' | _ }}
                </a>
            {% endif %}
        </div>
    {% endif %}

</div>
<div class="post-divider"></div>

{% put scripts %}
<script>
    $(window).on('ajaxErrorMessage', function (event, message) {
        event.preventDefault();

        $('.alerts').html('<div class="alert alert-danger" role="alert">' + message + '</div>');
    });
</script>
{% endput %}